import{_ as D,C as F}from"./Skeleton.vue_vue_type_script_setup_true_lang-eZAn_HhJ.js";import{K as V,o,l as d,F as C,E as q,D as s,f as n,d as A,A as N,a as x,w as f,aa as z,C as _,B,u as c,n as E,ac as P,H as v,_ as L,J as T,v as H,x as I,y as S,a3 as K}from"./index-0LozPYKy.js";import{_ as M}from"./ScrollArea.vue_vue_type_script_setup_true_lang-HsO_H1UU.js";import{_ as O}from"./Badge.vue_vue_type_script_setup_true_lang-Tymdlli1.js";const U={},j={class:"space-y-5"},G={class:"space-y-2 col-span-5"},Q={class:"space-y-2 col-span-5"},W={class:"flex gap-2"};function X(R,u){const i=D;return o(),d("ul",j,[(o(),d(C,null,q(4,r=>s("li",{key:r,class:"px-5 py-3 border rounded-md grid grid-cols-11 gap-10"},[s("div",G,[n(i,{class:"h-4 w-[300px]"}),n(i,{class:"h-4 w-[500px]"}),n(i,{class:"h-4 w-[400px]"})]),s("div",Q,[s("ul",W,[s("li",null,[n(i,{class:"h-4 w-[80px]"})]),s("li",null,[n(i,{class:"h-4 w-[130px]"})]),s("li",null,[n(i,{class:"h-4 w-[120px]"})])]),n(i,{class:"h-4 w-[100px]"})])])),64))])}const Y=V(U,[["render",X]]),Z={class:"space-y-5"},ss={class:"px-5 py-3 border rounded-md grid grid-cols-11 gap-10"},es={class:"space-y-2 col-span-5"},ts={class:"font-medium"},os={class:"text-muted-foreground"},ns={class:"space-y-2 col-span-5"},as={class:"flex gap-2"},cs={class:"flex items-center justify-end"},is={key:0},ls={class:"w-[70%] ml-auto mt-5 flex gap-5 items-center"},rs={class:"px-5 py-3 border rounded-md grow flex gap-5 items-center"},ds={class:"space-y-5 grow"},_s={class:"flex"},ps=s("span",{class:"w-20 shrink-0"},"from",-1),us={class:"font-medium"},ms={class:"flex"},hs=s("span",{class:"w-20 shrink-0"},"message:",-1),fs={class:"px-3 py-2 bg-secondary border rounded-md grow"},gs=A({__name:"RequestSection",props:{jobs:{}},emits:["accept"],setup(R,{emit:u}){const i=u,r=N(-1);return(g,b)=>{const m=O,h=L,w=T,$=z("CornerDownRight"),p=M;return o(),x(p,{class:"h-[500px]"},{default:f(()=>[s("ul",Z,[(o(!0),d(C,null,q(g.jobs,e=>(o(),d("li",{key:e.id},[s("div",ss,[s("div",es,[s("div",ts,_(e.title)+" #"+_(e.id),1),s("div",os,_(e.description),1)]),s("div",ns,[s("ul",as,[(o(!0),d(C,null,q(e.tags,(a,l)=>(o(),d("li",{key:l},[n(m,{variant:"secondary"},{default:f(()=>[B(_(a),1)]),_:2},1024)]))),128))]),n(h,null,{default:f(()=>[B(_(e.price),1)]),_:2},1024)]),s("div",cs,[n(w,{disabled:!e.requests.length,variant:"outline",size:"icon",onClick:a=>r.value=c(r)===e.id?-1:e.id},{default:f(()=>[n(c(F),{class:E(["transition-transform",{"rotate-180":e.id===c(r)}])},null,8,["class"])]),_:2},1032,["disabled","onClick"])])]),n(P,{"enter-active-class":"transition-all duration-500 ease","leave-active-class":"transition-all duration-500 ease","enter-from-class":"opacity-0 translate-x-[10rem]","leave-to-class":"opacity-0 translate-x-[10rem]"},{default:f(()=>[e.requests.length&&e.id===c(r)?(o(),d("ul",is,[(o(!0),d(C,null,q(e.requests,a=>(o(),d("li",{key:a.id},[s("div",ls,[n($,{size:16}),s("div",rs,[s("div",ds,[s("div",_s,[ps,s("span",us,_(a.buyer),1)]),s("div",ms,[hs,s("div",fs,_(a.message),1)])]),n(w,{disabled:a.accepted,onClick:l=>i("accept",c(r),a.id)},{default:f(()=>[B(" accept ")]),_:2},1032,["disabled","onClick"])])])]))),128))])):v("",!0)]),_:2},1024)]))),128))])]),_:1})}}}),bs={class:"py-10 space-y-10"},ys={class:"space-y-5"},xs={class:"text-2xl font-medium flex items-center gap-1"},vs=s("p",null,"pending",-1),ws={class:"text-muted-foreground text-base"},$s={class:"space-y-5"},ks={class:"text-2xl font-medium flex items-center gap-1"},Cs=s("p",null,"accepted",-1),qs={class:"text-muted-foreground text-base"},As=A({__name:"requests",async setup(R){let u,i;const r=H(),g=([u,i]=I(()=>r.getJobFactory()),u=await u,i(),u),b=S([]),m=S([]),h=N(!1);async function w(){h.value=!0;const p=(await g.getAllJobsOfUser(r.address)).map(t=>({owner:t[0],id:Number(t[1]),title:t[2],description:t[3],price:Number(t[4]),inProcess:t[5],tags:t[6],requests:[]})),e=p.map(t=>g.getJobBuyRequests(t.id));(await Promise.all(e)).forEach((t,y)=>{const J=t.map(k=>({id:Number(k[1]),buyer:k[2],message:k[3],accepted:k[4]}));p[y].requests.push(...J)});const l=p.reduce((t,y)=>(y.requests.some(J=>J.accepted)?t.acceptedJobs.push(y):t.pendingJobs.push(y),t),{pendingJobs:[],acceptedJobs:[]});b.value=l.pendingJobs,m.value=l.acceptedJobs,h.value=!1}K(()=>{w()});async function $(p,e){const l=await(await g.acceptBuyRequest(p,e)).wait();(l==null?void 0:l.status)===1&&window.location.reload()}return(p,e)=>{const a=gs,l=Y;return o(),d("div",bs,[s("div",ys,[s("h2",xs,[vs,s("span",ws," ("+_(c(b).length)+") ",1)]),c(b).length?(o(),x(a,{key:0,jobs:c(b),onAccept:$},null,8,["jobs"])):v("",!0),c(h)?(o(),x(l,{key:1})):v("",!0)]),s("div",$s,[s("h2",ks,[Cs,s("span",qs," ("+_(c(m).length)+") ",1)]),c(m).length?(o(),x(a,{key:0,jobs:c(m),onAccept:$},null,8,["jobs"])):v("",!0),c(h)?(o(),x(l,{key:1})):v("",!0)])])}}});export{As as default};
